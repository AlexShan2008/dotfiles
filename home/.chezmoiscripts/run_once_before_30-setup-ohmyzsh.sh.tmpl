{{- if eq .chezmoi.os "darwin" -}}
#!/bin/sh
# Install Oh My Zsh and plugins (run once)

set -e

ZSH_PLUGINS_PREFIX="${HOME}/.zsh/plugins"

# Install Oh My Zsh (unattended)
if [ -d "${HOME}/.oh-my-zsh" ]; then
  echo "[INFO] Oh My Zsh already installed"
else
  echo "[INFO] Installing Oh My Zsh..."
  sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)" "" --unattended
  echo "[INFO] Oh My Zsh installed"
fi

# Install plugins
mkdir -p "${ZSH_PLUGINS_PREFIX}"

# Symlink Oh My Zsh built-in git plugin instead of downloading separately
if [ ! -e "${ZSH_PLUGINS_PREFIX}/git" ] && [ -d "${HOME}/.oh-my-zsh/plugins/git" ]; then
  echo "[INFO] Linking git plugin from Oh My Zsh..."
  ln -sf "${HOME}/.oh-my-zsh/plugins/git" "${ZSH_PLUGINS_PREFIX}/git"
fi

if [ ! -d "${ZSH_PLUGINS_PREFIX}/zsh-autosuggestions" ]; then
  echo "[INFO] Installing zsh-autosuggestions..."
  git clone https://github.com/zsh-users/zsh-autosuggestions "${ZSH_PLUGINS_PREFIX}/zsh-autosuggestions"
fi

if [ ! -d "${ZSH_PLUGINS_PREFIX}/zsh-completions" ]; then
  echo "[INFO] Installing zsh-completions..."
  git clone https://github.com/zsh-users/zsh-completions "${ZSH_PLUGINS_PREFIX}/zsh-completions"
fi

if [ ! -d "${ZSH_PLUGINS_PREFIX}/fsh" ]; then
  echo "[INFO] Installing fast-syntax-highlighting..."
  git clone https://github.com/zdharma-continuum/fast-syntax-highlighting.git "${ZSH_PLUGINS_PREFIX}/fsh"
fi

echo "[INFO] Oh My Zsh and plugins setup complete"
{{- end }}
